# CUDA

## kernel_func

1. å…¶åœ¨GPUä¸Šå¹¶è¡Œæ‰§è¡Œï¼Œæ— éœ€æ˜¾ç¤ºè¿›è¡Œçº¿ç¨‹ç¼–å†™ç­‰æ“ä½œ
2. æ ¸å‡½æ•°éœ€è¦é™å®šè¯`__global__`ä¿®é¥°(è¿˜æœ‰å…¶ä»–é™å®šè¯)
3. è¿”å›å€¼ä¸ºvoid

```cpp
__global__ void kernel_func(argument arg)
{
    // code here
}
```

> æ ¸å‡½æ•°(ä»¥ä¸‹ç®€ç§°k_f)åªèƒ½è®¿é—®**GPUå†…å­˜**  
> k_fä¸èƒ½ä½¿ç”¨**å˜é•¿å‚æ•°**ã€**é™æ€å˜é‡**ã€**å‡½æ•°æŒ‡é’ˆ**  
> k_få…·æœ‰**å¼‚æ­¥æ€§**ï¼šCPUè°ƒç”¨k_få¯åŠ¨æ ¸å‡½æ•°æ‰§è¡Œï¼Œä½†ä¸ä¼šç­‰å¾…k_fæ‰§è¡Œå®Œæ¯•ï¼Œå› æ­¤éœ€è¦ç”¨åˆ°cpuä¸gpu**åŒæ­¥**(â—é‡è¦â—)  
> k_fä¸æ”¯æŒ`<iostream>`

```cpp
#include <stdio.h>

__global__ void hello()
{
    printf("hello cuda\n");
}

int main()
{
    hello<<<4, 4>>>();  // ç¬¬ä¸€ä¸ª4è¡¨ç¤ºçº¿ç¨‹å—çš„æ•°é‡(ä¸Šé™1024,0~2^23-1)
    // ç¬¬äºŒä¸ª4è¡¨ç¤ºæ¯ä¸ªçº¿ç¨‹å—çº¿ç¨‹çš„æ•°é‡ï¼Œæ­¤å¤„ä¸€å…±16çº¿ç¨‹

    cudaDeviceSynchronize();  // åŒæ­¥cpuä¸gpuï¼Œåˆ·æ–°æ ¸å‡½æ•°è¿è¡Œç»“æœ
    return 0;
}
```

## çº¿ç¨‹æ¨¡å‹ç»“æ„

> å›¾ä¸­å‘ˆç°çš„ä»…ä»…æ˜¯é€»è¾‘ä¸Šåˆ†å—ï¼Œå®é™…ç‰©ç†ä¸Šæ˜¯æ²¡æœ‰åˆ†å—çš„ã€‚

![çº¿ç¨‹æ¨¡å‹ç»“æ„](cuda_pics/çº¿ç¨‹æ¨¡å‹ç»“æ„.png  "çº¿ç¨‹æ¨¡å‹ç»“æ„")  
ä¸Šå›¾ä¸­**Host**æŒ‡åœ¨cpuä¸­æ‰§è¡Œçš„é€»è¾‘ï¼Œ**Device**æŒ‡gpuè¿è¡Œéƒ¨åˆ†  
**Grid1**æŒ‡æ ¸å‡½æ•°kernel1æŒ‡å®šçš„çº¿ç¨‹å—(ä¸Šé™1024,0~2^23-1)ï¼Œå…¶ä¸­çš„**block**æŒ‡åŒ…å«çš„çº¿ç¨‹æ•°

### ä¸€ç»´çº¿ç¨‹æ¨¡å‹(æœ‰ä¸€ç»´å½“ç„¶æœ‰å¤šç»´ğŸ˜¤)

1. æ¯ä¸ªçº¿ç¨‹åœ¨æ ¸å‡½æ•°ä¸­éƒ½æœ‰å”¯ä¸€æ ‡è¯†ï¼Œå…¶æ ‡è¯†ç”±**grid_size, block_size**å”¯ä¸€ç¡®å®šã€‚  
è€Œè¿™ä¸¤ä¸ªå€¼ä¿å­˜åœ¨**å†…å»ºå˜é‡(build-in variable)**ï¼š`gridDim.x & blockDim.x`ä¸­ã€‚
> ğŸ‘‰å†…å»ºå˜é‡æŒ‡ä¸ç”¨å£°æ˜ï¼Œç›´æ¥å¯ä»¥ä½¿ç”¨çš„å˜é‡ã€‚

2. è€Œéœ€è¦ç´¢å¼•çº¿ç¨‹çš„æ—¶å€™ï¼Œå¯æ ¹æ®å†…å»ºå˜é‡`blockidx.x & threadidx.x`è¿›è¡Œç´¢å¼•ï¼Œå®ƒä»¬å–å€¼èŒƒå›´åˆ†åˆ«æ˜¯ï¼š`blockidx.x`: `0~gridDim.x-1`, `threadidx.x`:`0~blockDim.x-1`  
å¦‚ä¸‹å›¾æ‰€ç¤ºğŸ‘‡
![çº¿ç¨‹æ ‡è¯†](cuda_pics/Thread_idx.png)

```cpp
__global__ void kernel_func()
{
    // code here
}

int main()
{
    // çº¿ç¨‹çš„å”¯ä¸€æ ‡è¯†ç”±grid_size, block_sizeç¡®å®šğŸ‘‡
    kernel_func<<<grid_size, block_size>>>();
    return 0;
}
```

### å¤šç»´çº¿ç¨‹(æœ€å¤šä¸‰ç»´)

ğŸ‘‡  **uint3  dim3  xyz**
![å¤šç»´çº¿ç¨‹1](cuda_pics/å¤šç»´çº¿ç¨‹1.png) ![å¤šç»´çº¿ç¨‹2](cuda_pics/å¤šç»´çº¿ç¨‹2.png)  

